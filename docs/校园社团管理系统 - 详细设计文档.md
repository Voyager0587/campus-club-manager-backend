# 校园社团管理系统 - 详细设计文档

## 1. 用户登录功能 - 顺序图

```plantuml
@startuml
actor 用户
participant UserController
participant UserServiceImpl
participant UserMapper
participant StpUtil
database MySQL

用户 -> UserController: POST /user/login\n{username, password}
activate UserController

UserController -> UserServiceImpl: login(LoginRequest)
activate UserServiceImpl

UserServiceImpl -> UserServiceImpl: 构建查询条件\neq(username)
UserServiceImpl -> UserMapper: selectOne(queryWrapper)
activate UserMapper
UserMapper -> MySQL: SELECT * FROM user\nWHERE username=?
MySQL --> UserMapper: User对象
UserMapper --> UserServiceImpl: User对象
deactivate UserMapper

alt 用户不存在
    UserServiceImpl --> UserController: 抛出BusinessException\n"用户名或密码错误"
    UserController --> 用户: 400 错误响应
else 用户存在
    UserServiceImpl -> UserServiceImpl: encryptPassword(password)\nMD5(password+SALT)
    
    alt 密码错误
        UserServiceImpl --> UserController: 抛出BusinessException\n"用户名或密码错误"
        UserController --> 用户: 400 错误响应
    else 密码正确
        alt 账户已禁用
            UserServiceImpl --> UserController: 抛出BusinessException\n"账户已被禁用"
            UserController --> 用户: 400 错误响应
        else 账户正常
            UserServiceImpl -> StpUtil: login(userId)
            activate StpUtil
            StpUtil --> UserServiceImpl: 登录成功
            deactivate StpUtil
            
            UserServiceImpl -> StpUtil: getTokenValue()
            activate StpUtil
            StpUtil --> UserServiceImpl: token字符串
            deactivate StpUtil
            
            UserServiceImpl -> UserServiceImpl: convertToUserInfoVO(user)
            UserServiceImpl --> UserController: LoginResponse\n{token, userInfo}
            deactivate UserServiceImpl
            
            UserController --> 用户: 200 OK\n{code, message, data}
            deactivate UserController
        end
    end
end

@enduml
```

## 2. 用户注册功能 - 顺序图

```plantuml
@startuml
actor 用户
participant UserController
participant UserServiceImpl
participant UserMapper
database MySQL

用户 -> UserController: POST /user/register\n{username, password, studentId, email...}
activate UserController

UserController -> UserServiceImpl: register(RegisterRequest)
activate UserServiceImpl

UserServiceImpl -> UserMapper: count(username查询条件)
activate UserMapper
UserMapper -> MySQL: SELECT COUNT(*)\nWHERE username=?
MySQL --> UserMapper: count
UserMapper --> UserServiceImpl: count
deactivate UserMapper

alt 用户名已存在
    UserServiceImpl --> UserController: 抛出BusinessException\n"用户名已存在"
    UserController --> 用户: 400 错误响应
else 用户名可用
    UserServiceImpl -> UserMapper: count(studentId查询条件)
    activate UserMapper
    UserMapper -> MySQL: SELECT COUNT(*)\nWHERE student_id=?
    MySQL --> UserMapper: count
    UserMapper --> UserServiceImpl: count
    deactivate UserMapper
    
    alt 学号已存在
        UserServiceImpl --> UserController: 抛出BusinessException\n"学号已存在"
        UserController --> 用户: 400 错误响应
    else 学号可用
        UserServiceImpl -> UserMapper: count(email查询条件)
        activate UserMapper
        UserMapper -> MySQL: SELECT COUNT(*)\nWHERE email=?
        MySQL --> UserMapper: count
        UserMapper --> UserServiceImpl: count
        deactivate UserMapper
        
        alt 邮箱已存在
            UserServiceImpl --> UserController: 抛出BusinessException\n"邮箱已存在"
            UserController --> 用户: 400 错误响应
        else 邮箱可用
            UserServiceImpl -> UserServiceImpl: 创建User对象\n设置role=USER, status=1
            UserServiceImpl -> UserServiceImpl: encryptPassword(password)
            UserServiceImpl -> UserMapper: save(user)
            activate UserMapper
            UserMapper -> MySQL: INSERT INTO user
            MySQL --> UserMapper: 插入成功
            UserMapper --> UserServiceImpl: 成功
            deactivate UserMapper
            
            UserServiceImpl --> UserController: 注册成功
            deactivate UserServiceImpl
            UserController --> 用户: 200 OK\n"注册成功"
            deactivate UserController
        end
    end
end

@enduml
```

## 3. 申请加入社团功能 - 顺序图

```plantuml
@startuml
actor 学生
participant ClubController
participant ClubServiceImpl
participant ClubMapper
participant ClubMemberMapper
participant ClubApplicationMapper
participant StpUtil
database MySQL

学生 -> ClubController: POST /club/apply\n{clubId, reason}
activate ClubController

ClubController -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ClubController: userId
deactivate StpUtil

ClubController -> ClubServiceImpl: applyJoinClub(request)
activate ClubServiceImpl

ClubServiceImpl -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ClubServiceImpl: userId
deactivate StpUtil

ClubServiceImpl -> ClubMapper: selectById(clubId)
activate ClubMapper
ClubMapper -> MySQL: SELECT * FROM club\nWHERE id=?
MySQL --> ClubMapper: Club对象
ClubMapper --> ClubServiceImpl: Club对象
deactivate ClubMapper

alt 社团不存在
    ClubServiceImpl --> ClubController: 抛出BusinessException\n"社团不存在"
    ClubController --> 学生: 400 错误响应
else 社团存在
    alt 社团状态!=NORMAL
        ClubServiceImpl --> ClubController: 抛出BusinessException\n"该社团暂不可加入"
        ClubController --> 学生: 400 错误响应
    else 社团状态正常
        ClubServiceImpl -> ClubMemberMapper: selectCount(clubId+userId)
        activate ClubMemberMapper
        ClubMemberMapper -> MySQL: SELECT COUNT(*)\nWHERE club_id=? AND user_id=?
        MySQL --> ClubMemberMapper: count
        ClubMemberMapper --> ClubServiceImpl: count
        deactivate ClubMemberMapper
        
        alt 已是社团成员
            ClubServiceImpl --> ClubController: 抛出BusinessException\n"您已经是该社团成员"
            ClubController --> 学生: 400 错误响应
        else 不是成员
            ClubServiceImpl -> ClubApplicationMapper: selectCount(clubId+userId+PENDING)
            activate ClubApplicationMapper
            ClubApplicationMapper -> MySQL: SELECT COUNT(*)\nWHERE club_id=? AND user_id=?\nAND status='PENDING'
            MySQL --> ClubApplicationMapper: count
            ClubApplicationMapper --> ClubServiceImpl: count
            deactivate ClubApplicationMapper
            
            alt 已有待审核申请
                ClubServiceImpl --> ClubController: 抛出BusinessException\n"您已提交过申请，请等待审核"
                ClubController --> 学生: 400 错误响应
            else 可以申请
                ClubServiceImpl -> ClubServiceImpl: 创建ClubApplication对象\nstatus=PENDING
                ClubServiceImpl -> ClubApplicationMapper: insert(application)
                activate ClubApplicationMapper
                ClubApplicationMapper -> MySQL: INSERT INTO club_application
                MySQL --> ClubApplicationMapper: 插入成功
                ClubApplicationMapper --> ClubServiceImpl: 成功
                deactivate ClubApplicationMapper
                
                ClubServiceImpl --> ClubController: 申请提交成功
                deactivate ClubServiceImpl
                ClubController --> 学生: 200 OK\n"申请已提交"
                deactivate ClubController
            end
        end
    end
end

@enduml
```

## 4. 审核入社申请功能 - 顺序图

```plantuml
@startuml
actor 社团负责人
participant ClubManagementController
participant ClubServiceImpl
participant ClubApplicationMapper
participant ClubMemberMapper
participant StpUtil
database MySQL

社团负责人 -> ClubManagementController: POST /club/management/{clubId}/applications/review\n{applicationId, status, reviewNote}
activate ClubManagementController

ClubManagementController -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ClubManagementController: userId
deactivate StpUtil

ClubManagementController -> ClubServiceImpl: reviewApplicationByLeader(clubId, request)
activate ClubServiceImpl

ClubServiceImpl -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ClubServiceImpl: userId
deactivate StpUtil

ClubServiceImpl -> ClubServiceImpl: verifyClubLeader(clubId, userId)
activate ClubServiceImpl
note right: 验证是否为社团负责人
ClubServiceImpl --> ClubServiceImpl: 验证通过
deactivate ClubServiceImpl

ClubServiceImpl -> ClubApplicationMapper: selectById(applicationId)
activate ClubApplicationMapper
ClubApplicationMapper -> MySQL: SELECT * FROM club_application\nWHERE id=?
MySQL --> ClubApplicationMapper: ClubApplication对象
ClubApplicationMapper --> ClubServiceImpl: ClubApplication对象
deactivate ClubApplicationMapper

alt 申请不存在
    ClubServiceImpl --> ClubManagementController: 抛出BusinessException\n"申请记录不存在"
    ClubManagementController --> 社团负责人: 400 错误响应
else 申请存在
    alt 申请不属于该社团
        ClubServiceImpl --> ClubManagementController: 抛出BusinessException\n"无权审核其他社团的申请"
        ClubManagementController --> 社团负责人: 400 错误响应
    else 申请属于该社团
        alt 申请状态!=PENDING
            ClubServiceImpl --> ClubManagementController: 抛出BusinessException\n"该申请已被处理"
            ClubManagementController --> 社团负责人: 400 错误响应
        else 申请待审核
            ClubServiceImpl -> ClubServiceImpl: 更新申请状态\nstatus, reviewNote, reviewTime, reviewerId
            ClubServiceImpl -> ClubApplicationMapper: updateById(application)
            activate ClubApplicationMapper
            ClubApplicationMapper -> MySQL: UPDATE club_application\nSET status=?, review_note=?...
            MySQL --> ClubApplicationMapper: 更新成功
            ClubApplicationMapper --> ClubServiceImpl: 成功
            deactivate ClubApplicationMapper
            
            alt status==APPROVED
                ClubServiceImpl -> ClubServiceImpl: 创建ClubMember对象\nrole=MEMBER
                ClubServiceImpl -> ClubMemberMapper: insert(member)
                activate ClubMemberMapper
                ClubMemberMapper -> MySQL: INSERT INTO club_member
                MySQL --> ClubMemberMapper: 插入成功
                ClubMemberMapper --> ClubServiceImpl: 成功
                deactivate ClubMemberMapper
            end
            
            ClubServiceImpl --> ClubManagementController: 审核完成
            deactivate ClubServiceImpl
            ClubManagementController --> 社团负责人: 200 OK\n"审核完成"
            deactivate ClubManagementController
        end
    end
end

@enduml
```

## 5. 创建活动功能 - 顺序图

```plantuml
@startuml
actor 社团负责人
participant ClubActivityController
participant ActivityServiceImpl
participant ClubMapper
participant ActivityMapper
participant StpUtil
database MySQL

社团负责人 -> ClubActivityController: POST /club-admin/activity/create\n{clubId, title, content, startTime...}
activate ClubActivityController

ClubActivityController -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ClubActivityController: userId
deactivate StpUtil

ClubActivityController -> ActivityServiceImpl: createActivity(request)
activate ActivityServiceImpl

ActivityServiceImpl -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ActivityServiceImpl: userId
deactivate StpUtil

ActivityServiceImpl -> ClubMapper: selectById(clubId)
activate ClubMapper
ClubMapper -> MySQL: SELECT * FROM club\nWHERE id=?
MySQL --> ClubMapper: Club对象
ClubMapper --> ActivityServiceImpl: Club对象
deactivate ClubMapper

alt 社团不存在
    ActivityServiceImpl --> ClubActivityController: 抛出BusinessException\n"社团不存在"
    ClubActivityController --> 社团负责人: 400 错误响应
else 社团存在
    ActivityServiceImpl -> ActivityServiceImpl: verifyClubLeader(clubId, userId)
    activate ActivityServiceImpl
    note right: 验证是否为社团负责人
    ActivityServiceImpl --> ActivityServiceImpl: 验证通过
    deactivate ActivityServiceImpl
    
    alt 结束时间早于开始时间
        ActivityServiceImpl --> ClubActivityController: 抛出BusinessException\n"活动结束时间不能早于开始时间"
        ClubActivityController --> 社团负责人: 400 错误响应
    else 时间合法
        alt 报名截止时间早于报名开始时间
            ActivityServiceImpl --> ClubActivityController: 抛出BusinessException\n"报名截止时间不能早于报名开始时间"
            ClubActivityController --> 社团负责人: 400 错误响应
        else 报名时间合法
            ActivityServiceImpl -> ActivityServiceImpl: 创建Activity对象\nstatus=PENDING\ncurrentMembers=0
            ActivityServiceImpl -> ActivityMapper: save(activity)
            activate ActivityMapper
            ActivityMapper -> MySQL: INSERT INTO activity
            MySQL --> ActivityMapper: 插入成功
            ActivityMapper --> ActivityServiceImpl: 成功
            deactivate ActivityMapper
            
            ActivityServiceImpl --> ClubActivityController: 活动创建成功
            deactivate ActivityServiceImpl
            ClubActivityController --> 社团负责人: 200 OK\n"活动创建成功，等待审核"
            deactivate ClubActivityController
        end
    end
end

@enduml
```

## 6. 活动报名功能 - 顺序图

```plantuml
@startuml
actor 学生
participant ActivityController
participant ActivityServiceImpl
participant ActivityMapper
participant ActivitySignupMapper
participant StpUtil
database MySQL

学生 -> ActivityController: POST /activity/{id}/signup
activate ActivityController

ActivityController -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ActivityController: userId
deactivate StpUtil

ActivityController -> ActivityServiceImpl: signupActivity(activityId)
activate ActivityServiceImpl

ActivityServiceImpl -> StpUtil: getLoginIdAsLong()
activate StpUtil
StpUtil --> ActivityServiceImpl: userId
deactivate StpUtil

ActivityServiceImpl -> ActivityMapper: getById(activityId)
activate ActivityMapper
ActivityMapper -> MySQL: SELECT * FROM activity\nWHERE id=?
MySQL --> ActivityMapper: Activity对象
ActivityMapper --> ActivityServiceImpl: Activity对象
deactivate ActivityMapper

alt 活动不存在
    ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"活动不存在"
    ActivityController --> 学生: 400 错误响应
else 活动存在
    alt 活动状态!=PUBLISHED
        ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"该活动不可报名"
        ActivityController --> 学生: 400 错误响应
    else 活动已发布
        ActivityServiceImpl -> ActivityServiceImpl: 获取当前时间now
        
        alt 报名未开始
            ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"报名尚未开始"
            ActivityController --> 学生: 400 错误响应
        else 报名已截止
            ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"报名已截止"
            ActivityController --> 学生: 400 错误响应
        else 报名时间内
            ActivityServiceImpl -> ActivitySignupMapper: selectOne(activityId+userId)
            activate ActivitySignupMapper
            ActivitySignupMapper -> MySQL: SELECT * FROM activity_signup\nWHERE activity_id=? AND user_id=?
            MySQL --> ActivitySignupMapper: ActivitySignup对象或null
            ActivitySignupMapper --> ActivityServiceImpl: existingSignup
            deactivate ActivitySignupMapper
            
            alt 已报名(status=REGISTERED)
                ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"您已报名该活动"
                ActivityController --> 学生: 400 错误响应
            else 曾取消报名(status=CANCELLED)
                ActivityServiceImpl -> ActivityServiceImpl: 更新报名记录\nstatus=REGISTERED
                ActivityServiceImpl -> ActivitySignupMapper: updateById(signup)
                activate ActivitySignupMapper
                ActivitySignupMapper -> MySQL: UPDATE activity_signup\nSET status='REGISTERED'
                MySQL --> ActivitySignupMapper: 更新成功
                ActivitySignupMapper --> ActivityServiceImpl: 成功
                deactivate ActivitySignupMapper
                
                ActivityServiceImpl -> ActivityServiceImpl: currentMembers++
                ActivityServiceImpl -> ActivityMapper: updateById(activity)
                activate ActivityMapper
                ActivityMapper -> MySQL: UPDATE activity\nSET current_members=?
                MySQL --> ActivityMapper: 更新成功
                ActivityMapper --> ActivityServiceImpl: 成功
                deactivate ActivityMapper
                
                ActivityServiceImpl --> ActivityController: 报名成功
                deactivate ActivityServiceImpl
                ActivityController --> 学生: 200 OK\n"报名成功"
                deactivate ActivityController
            else 未报名过
                alt 人数已满
                    ActivityServiceImpl --> ActivityController: 抛出BusinessException\n"活动报名人数已满"
                    ActivityController --> 学生: 400 错误响应
                else 人数未满
                    ActivityServiceImpl -> ActivityServiceImpl: 创建ActivitySignup对象\nstatus=REGISTERED
                    ActivityServiceImpl -> ActivitySignupMapper: insert(signup)
                    activate ActivitySignupMapper
                    ActivitySignupMapper -> MySQL: INSERT INTO activity_signup
                    MySQL --> ActivitySignupMapper: 插入成功
                    ActivitySignupMapper --> ActivityServiceImpl: 成功
                    deactivate ActivitySignupMapper
                    
                    ActivityServiceImpl -> ActivityServiceImpl: currentMembers++
                    ActivityServiceImpl -> ActivityMapper: updateById(activity)
                    activate ActivityMapper
                    ActivityMapper -> MySQL: UPDATE activity\nSET current_members=?
                    MySQL --> ActivityMapper: 更新成功
                    ActivityMapper --> ActivityServiceImpl: 成功
                    deactivate ActivityMapper
                    
                    ActivityServiceImpl --> ActivityController: 报名成功
                    deactivate ActivityServiceImpl
                    ActivityController --> 学生: 200 OK\n"报名成功"
                    deactivate ActivityController
                end
            end
        end
    end
end

@enduml
```

## 7. 社团申请审核流程 - 协作图

```plantuml
@startuml
object "1:学生" as Student
object "2:ClubController" as Controller
object "3:ClubServiceImpl" as Service
object "4:ClubApplicationMapper" as AppMapper
object "5:ClubMemberMapper" as MemberMapper
object "6:MySQL数据库" as DB

Student -> Controller : 1.1: POST /club/apply\n{clubId, reason}
Controller -> Service : 1.2: applyJoinClub(request)
Service -> Service : 1.3: 验证社团存在性和状态
Service -> AppMapper : 1.4: 检查是否已申请
AppMapper -> DB : 1.5: SELECT COUNT(*)
DB --> AppMapper : 1.6: count=0
AppMapper --> Service : 1.7: 未申请
Service -> AppMapper : 1.8: insert(application)
AppMapper -> DB : 1.9: INSERT INTO club_application
DB --> AppMapper : 1.10: 插入成功
AppMapper --> Service : 1.11: 成功
Service --> Controller : 1.12: 申请提交成功
Controller --> Student : 1.13: 200 OK

note right of Service
  协作关系：
  - 学生通过Controller提交申请
  - Service协调业务逻辑验证
  - AppMapper负责数据持久化
  - 最终结果返回给学生
end note

object "2.1:社团负责人" as Leader
object "2.2:ClubManagementController" as MgmtController

Leader -> MgmtController : 2.1: POST /club/management/{clubId}/applications/review
MgmtController -> Service : 2.2: reviewApplicationByLeader(clubId, request)
Service -> Service : 2.3: verifyClubLeader(clubId, userId)
Service -> AppMapper : 2.4: selectById(applicationId)
AppMapper -> DB : 2.5: SELECT * FROM club_application
DB --> AppMapper : 2.6: ClubApplication对象
AppMapper --> Service : 2.7: application
Service -> AppMapper : 2.8: updateById(application)\n设置status=APPROVED
AppMapper -> DB : 2.9: UPDATE club_application
DB --> AppMapper : 2.10: 更新成功
Service -> MemberMapper : 2.11: insert(member)\n添加为社团成员
MemberMapper -> DB : 2.12: INSERT INTO club_member
DB --> MemberMapper : 2.13: 插入成功
MemberMapper --> Service : 2.14: 成功
Service --> MgmtController : 2.15: 审核完成
MgmtController --> Leader : 2.16: 200 OK

@enduml
```

## 8. 活动报名流程 - 协作图

```plantuml
@startuml
object "1:学生" as Student
object "2:ActivityController" as Controller
object "3:ActivityServiceImpl" as Service
object "4:ActivityMapper" as ActMapper
object "5:ActivitySignupMapper" as SignupMapper
object "6:MySQL数据库" as DB

Student -> Controller : 1.1: POST /activity/{id}/signup
Controller -> Service : 1.2: signupActivity(activityId)
Service -> ActMapper : 1.3: getById(activityId)
ActMapper -> DB : 1.4: SELECT * FROM activity
DB --> ActMapper : 1.5: Activity对象
ActMapper --> Service : 1.6: activity
Service -> Service : 1.7: 验证活动状态、报名时间、人数限制
Service -> SignupMapper : 1.8: selectOne(activityId+userId)
SignupMapper -> DB : 1.9: SELECT * FROM activity_signup
DB --> SignupMapper : 1.10: null(未报名)
SignupMapper --> Service : 1.11: null
Service -> SignupMapper : 1.12: insert(signup)\nstatus=REGISTERED
SignupMapper -> DB : 1.13: INSERT INTO activity_signup
DB --> SignupMapper : 1.14: 插入成功
SignupMapper --> Service : 1.15: 成功
Service -> ActMapper : 1.16: updateById(activity)\ncurrentMembers++
ActMapper -> DB : 1.17: UPDATE activity
DB --> ActMapper : 1.18: 更新成功
ActMapper --> Service : 1.19: 成功
Service --> Controller : 1.20: 报名成功
Controller --> Student : 1.21: 200 OK

note right of Service
  协作关系：
  - 学生发起报名请求
  - Service验证活动状态和报名条件
  - SignupMapper创建报名记录
  - ActMapper更新活动报名人数
  - 事务保证数据一致性
end note

@enduml
```

## 9. 社团状态流转 - 状态图

```plantuml
@startuml
[*] --> NORMAL : 系统管理员创建社团
[*] --> PENDING : 用户申请创建社团

PENDING --> NORMAL : 系统管理员审核通过
PENDING --> DISABLED : 系统管理员审核拒绝

NORMAL --> DISABLED : 系统管理员禁用社团
DISABLED --> NORMAL : 系统管理员启用社团

NORMAL --> [*] : 系统管理员删除社团\n(逻辑删除)
DISABLED --> [*] : 系统管理员删除社团\n(逻辑删除)

note right of NORMAL
  正常状态：
  - 可以被用户浏览
  - 可以接受入社申请
  - 可以创建活动
  - 社团负责人可管理
end note

note right of DISABLED
  禁用状态：
  - 不可被用户浏览
  - 不可接受入社申请
  - 不可创建活动
end note

note right of PENDING
  待审核状态：
  - 用户创建社团后的初始状态
  - 等待系统管理员审核
  - 不可被其他用户浏览
end note

@enduml
```

## 10. 入社申请状态流转 - 状态图

```plantuml
@startuml
[*] --> PENDING : 学生提交入社申请

PENDING --> APPROVED : 社团负责人/系统管理员\n审核通过
PENDING --> REJECTED : 社团负责人/系统管理员\n审核拒绝

APPROVED --> [*] : 流程结束\n(用户已成为社团成员)
REJECTED --> [*] : 流程结束

note right of PENDING
  待审核状态：
  - 申请已提交
  - 等待审核
  - 同一用户对同一社团
    只能有一个PENDING申请
end note

note right of APPROVED
  审核通过：
  - 自动创建ClubMember记录
  - role=MEMBER
  - 用户成为社团普通成员
  - 记录审核人、审核时间、审核备注
end note

note right of REJECTED
  审核拒绝：
  - 不创建成员记录
  - 记录审核人、审核时间、审核备注
  - 用户可重新申请
end note

@enduml
```

## 11. 活动状态流转 - 状态图

```plantuml
@startuml
[*] --> DRAFT : 社团负责人创建活动\n(保存草稿)
[*] --> PENDING : 社团负责人创建活动\n(提交审核)

DRAFT --> PENDING : 社团负责人提交审核
DRAFT --> [*] : 社团负责人删除草稿

PENDING --> PUBLISHED : 系统管理员审核通过
PENDING --> CANCELLED : 系统管理员审核拒绝
PENDING --> CANCELLED : 社团负责人取消活动

PUBLISHED --> CANCELLED : 社团负责人取消活动
PUBLISHED --> COMPLETED : 活动结束时间到达

COMPLETED --> [*] : 活动归档

CANCELLED --> [*] : 活动归档

note right of DRAFT
  草稿状态：
  - 活动信息未完善
  - 仅创建者可见
  - 可以修改
  - 可以删除
end note

note right of PENDING
  待审核状态：
  - 等待系统管理员审核
  - 不可报名
  - 可以修改
  - 可以取消
end note

note right of PUBLISHED
  已发布状态：
  - 审核通过
  - 用户可浏览和报名
  - 不可修改
  - 可以取消
  - 社团负责人可管理报名
end note

note right of COMPLETED
  已完成状态：
  - 活动已结束
  - 不可报名
  - 不可取消
  - 可查看历史记录
end note

note right of CANCELLED
  已取消状态：
  - 活动被取消或审核拒绝
  - 所有报名记录自动取消
  - 不可恢复
end note

@enduml
```

## 12. 活动报名状态流转 - 状态图

```plantuml
@startuml
[*] --> REGISTERED : 学生报名活动

REGISTERED --> CANCELLED : 学生取消报名\n(活动开始前)
REGISTERED --> CHECKED_IN : 社团负责人签到
REGISTERED --> ABSENT : 社团负责人标记缺席

CANCELLED --> REGISTERED : 学生重新报名

CHECKED_IN --> [*] : 活动结束
ABSENT --> [*] : 活动结束
CANCELLED --> [*] : 活动结束或取消

note right of REGISTERED
  已报名状态：
  - 报名成功
  - 活动currentMembers+1
  - 活动开始前可取消
  - 等待活动开始
end note

note right of CANCELLED
  已取消状态：
  - 用户主动取消
  - 或活动被取消导致
  - 活动currentMembers-1
  - 可以重新报名
end note

note right of CHECKED_IN
  已签到状态：
  - 社团负责人确认签到
  - 记录签到时间
  - 不可取消
  - 表示用户参加了活动
end note

note right of ABSENT
  缺席状态：
  - 社团负责人标记缺席
  - 用户未参加活动
  - 不可取消
  - 可能影响信用记录
end note

@enduml
```

## 13. 权限验证流程 - 协作图

```plantuml
@startuml
object "1:用户请求" as Request
object "2:SaTokenInterceptor" as Interceptor
object "3:Controller" as Controller
object "4:StpUtil" as StpUtil
object "5:ServiceImpl" as Service
object "6:ClubMemberMapper" as Mapper
object "7:MySQL数据库" as DB

Request -> Interceptor : 1.1: HTTP请求\nHeader: Authorization=token
Interceptor -> StpUtil : 1.2: checkLogin()\n验证token有效性
StpUtil --> Interceptor : 1.3: token有效
Interceptor -> StpUtil : 1.4: checkRole("user")\n验证用户角色
StpUtil
```